# TCP协议
## 对TCP的理解，三次握手，四次分手，滑动窗口

### 白话三次握手
1. 发送者问接收者: 我发消息了，你收到了嘛？
2. 接收者回复发送者: 我收到了，你发消息没问题，我收消息也没问题。但我不知道我的发消息有没有问题，你收到了回复我下。
3. 发送者告诉接收者: 我收到你的消息了，你发消息没问题。通信成功我们开始工作吧！

### 三次握手过程
1. 客户端首先发送SYN=1，表示要创建连接
2. 服务端接收到后，要告诉客户端：我接受到了！所以加个ACK=1，就变成了ACK=1,SYN=1
3. 理论上这时就创建连接成功了，但是要防止一个意外（见疑问三），所以客户端要再发一个消息给服务端确认一下，这时只需要ACK=1就行了。三次握手完成！

### 为何要三次握手
如果发送两次就可以建立连接的话，那么只要客户端发送一个连接请求，服务端接收到并发送了确认，就会建立一个连接。

可能出现的问题：如果一个连接请求在网络中跑的慢，超时了，这时客户端会重新发送请求，但是这个跑的慢的请求最后还是跑到了，这时服务端就接收了两个连接请求，然后全部回应就会创建两个连接，浪费资源！

如果加了第三次客户端确认，服务端在接受到一个客户端端连接请求后，后面再接收到连接请求就可以抛弃不管了。

### 四次分手过程

TCP协议是一种面向连接的、可靠的、基于字节流的运输层通信协议。TCP是全双工模式。
1. 客户端发出FIN=1报文段，表示客户端已经没有数据要发送了（这个时候客户端还是可以接受来自服务端的数据）。
2. 服务端返回ACK=1报文段，表示它已经知道客户端没有数据发送了（服务端还是可以发送数据到客户端的）。
3. 这时只关闭了一个方向，另一个方向也需要关闭，所以服务端也发送了FIN=1 ACK=1报文段，这个时候就表示服务端也没有数据要发送了。
4. 客户端接受到后返回ACK=1报文，彼此就会愉快的中断这次TCP连接，四次分手完成。

### 为何需要四次分手
TCP是双向的，所以需要在两个方向分别关闭，每个方向的关闭又需要请求和确认，所以一共就4次。

### SYN、ACK、FIN、seq、ack各代表什么意思
1. SYN：代表请求创建连接，所以在三次握手中前两次要SYN=1，表示这两次用于建立连接
2. FIN：表示请求关闭连接，在四次分手时，我们发现FIN发了两遍。这是因为TCP的连接是双向的，所以一次FIN只能关闭一个方向。
3. ACK：代表确认接受，从上面可以发现，不管是三次握手还是四次分手，在回应的时候都会加上ACK=1，表示消息接收到了，并且在建立连接以后的发送数据时，都需加上ACK=1,来表示数据接收成功。
4. seq:序列号，什么意思呢？当发送一个数据时，数据是被拆成多个数据包来发送，序列号就是对每个数据包进行编号，这样接受方才能对数据包进行再次拼接。
5. ack:这个代表下一个数据包的编号，这也就是为什么第二请求时，ack是seq+1，

### 超时重发
当发送者向接收者发包后，如果过了一段时间(超时时间)依然没有收到消息，就当做本次包丢失，需要重新补发。
并且如果一次性发了三个包，只要最后一个包确认收到之后就默认前面两个也收到了。

## 拥塞控制

### 滑动窗口
假设一次性发送包的大小为3，那么每次可以发3个包，而且可以边发边接收，这样就会增强效率。这里的3就是滑动窗口的大小，这样的发送方式也叫滑动窗口协议。

## TCP协议如何提高传输效率

### 滑动窗口
在确认应答机制中，接收方每接受到一个数据段，都要给发送方发送一个ack应答报文，发送方在接收到应答报文后才继续发送下一个报文段，这样可以保证数据传送的可靠性，但是这样做性能较差，尤其在数据往返时间较长的时候。TCP中引入了滑动窗口机制，只要数据处于这个滑动窗口中，就可以在上一个数据段未收到确认时依然将后面的数据发出去。这样可以一次发送多条数据，就大大的提高了性能。

滑动窗口大小：指无需等待确认应答而可以继续发送数据的最大值。操作系统为例维护这个滑动窗口，需要开辟一个发送缓冲区，只有确认过的数据才能从缓冲区删掉。

### 重发控制
无论何种情况都可能会发生丢包问题，那么如果没有经过确认就批量发送报文段如果发生丢包问题该如何解决？
a.发送报文丢失
接受端在没有收到自己所期望序号的数据时，会对之前收到的数据进行确认应答。发送端一旦收到某个确认应答后，又连续三次收到其他的确认应答，则认为数据段已经丢失，需要进行重发，这种机制比起超时机制可以提供更为快速的重发服务。

b.应答报文丢失
接收方发出的ack报文也可能在中途丢失，这样发送方就可能收不到前面发送的数据的确认报文，但是如果收到了后续报文段的ack也会认为前面的报文段已经被接受方收到，这样就进行了确认。

### 延迟应答
接收方每收到2个包就发送一个确认应答， 等待200ms还没有其他数据包到达的情况下也会发送确认应答。

### 捎带应答
有时客户端与服务器之间的交互在应用层也是“一发一收”的，即接收方没收到报文段后，随机也给发送方发送数据。这种情况下就可以使用“捎带应答”机制，接收方的确认报文可以搭“顺风车”到发送方，可以提高网络利用率。

---
# HTTP协议

## 请描述一个完整的HTTP请求过程
1. 域名经过DSN协议解析成IP地址
2. 经过HTTP协议生成HTTP请求报文
3. 经过TCP协议将HTTP请求报文按序号分割成多个报文段并传送
4. 经过IP协议搜索对方地址，一边中转一边传送
5. 经过TCP协议接受报文并重组
6. 经过HTTP协议，返回处理后的报文资源

## http和https的差别及内在原理
http是超文本传输协议，信息是明文传输，https则是具有安全性的ssl加密传输协议。

## http2.0的新特性
多路复用、服务器推送、头信息压缩、二进制协议等

## 传输层网络协议TCP与UDP的对比分析等。
1. TCP面向连接（TCP三次握手）; UDP是无连接的，即发送数据之前不需要建立连接。
2. TCP提供可靠的服务。也就是说，通过TCP连接传送的数据，无差错，不丢失，不重复，且按序到达;UDP尽最大努力交付，即不保证可靠交付。
3. UDP具有较好的实时性，工作效率比TCP高
4. TCP连接是点到点的; UDP支持一对一，一对多，多对一和多对多的交互通信。

## UDP的应用场景
1. 需要资源少，网络情况稳定的内网，或者对于丢包不敏感的应用，比如 DHCP 就是基于 UDP 协议的。
2. 不需要一对一沟通，建立连接，而是可以广播的应用。因为它不面向连接，所以可以做到一对多
3. 需要处理速度快，可以容忍丢包，但是即使网络拥塞，也毫不退缩，一往无前的时候

场景：直播、实时游戏、物联网

https://blog.csdn.net/zhang6223284/article/details/81414149

## Https详细讲一下原理
一个HTTPS请求实际上包含了两次HTTP传输，可以细分为8步。

1. 客户端向服务器发起HTTPS请求。
2. 服务器端有一个密钥对，即公钥和私钥，是用来进行非对称加密使用的，服务器端保存着私钥，不能将其泄露，公钥可以发送给任何人。
3. 服务器将自己的公钥发送给客户端。
4. 客户端收到服务器端的公钥之后，会对公钥进行检查，验证其合法性（CA数字证书），如果发现发现公钥有问题，那么HTTPS传输就无法继续。如果公钥合格，那么客户端会生成一个随机值，这个随机值就是用于进行对称加密的密钥，我们将该密钥称之为客户端密钥，这样在概念上和服务器端的密钥容易进行区分。然后用服务器的公钥对客户端密钥进行非对称加密，这样客户端密钥就变成密文了，至此，HTTPS中的第一次HTTP请求结束。
5. 客户端会发起HTTPS中的第二个HTTP请求，将加密之后的客户端密钥发送给服务器。
6. 服务器接收到客户端发来的密文之后，会用自己的私钥对其进行非对称解密，解密之后的明文就是客户端密钥，然后用客户端密钥对数据进行对称加密，这样数据就变成了密文。
7. 然后服务器将加密后的密文发送给客户端。
8. 客户端收到服务器发送来的密文，用客户端密钥对其进行对称解密，得到服务器发送的数据。这样HTTPS中的第二个HTTP请求结束，整个HTTPS传输完成。