# 综合问题

## 为什么使用消息队列？
主要有三个核心场景：解耦、异步、削峰

## 使用消息队列有什么缺点？
1.系统可用性降低：MQ挂了你就挂了
2.系统复杂性提高：消息顺序性、消息重复消费、消息丢失
3.一致性问题：多个系统交互的一致性

## kafka、activemq、rabbitmq、rocketmq的优缺点
### activemq
官方社区不活跃
### rabbitmq
elang语言实现，吞吐量到万级、管理后台好、开源社区活跃
### rocketmq：
java语言实现，阿里双十一背书，吞吐量单机十万级
### kafka
java语言实现，大数据领域实时计算和日志采集，吞吐量单机十万级，偶尔会有数据丢失的现象。

## 如果让你来设计一个MQ你会怎么做？
其实碰到这样的问题，我们可以挑一个我们熟悉的MQ，把他的一些关键特性说出来就行了，所以要求我们不仅仅会用这个产品，还得了解它底层的原理。
### 可伸缩性
资源不够用可以通过给topic增加partition来提高吞吐量。
### 高可用 
数据冗余在多个broker上，leader挂掉会选举出新的follower。
### 持久化
数据会落地磁盘，确保进程挂了数据不会丢。


## 消息队列的使用场景
### 延迟队列
订单下单30分钟之后，如果用户没有付钱，则系统自动取消订单。通常的做法是定时轮询数据库，然后更新状态。但如果数据量上亿，那查询都是一个问题。在RabbitMQ中可以利用死信队列来实现。
### 异步处理
不需要实时处理的消息，如果写mysql后，数据还需要往缓存同步，可以通过mq来写缓存的目的。
### 应用解耦
大型微服务架构中，使用mq做消息中转
### 分布式事务最终一致性
基于消息中间件做分布式消息补偿，实现最终一致性
### 流量削峰
秒杀或团购活动中，缓解短时间压垮系统
### 日志处理
日志采集的时候通过队列做消息的传输和暂存。