# zookeeper

## zookeeper的应用场景有哪些？

### 分布式协调

A系统发送个请求到MQ，然后B系统消费消息之后处理了。那么A系统如何知道B系统的处理结果呢？用zookeeper就可以实现分布式系统之间的协调工作。A系统发送请求之后可以再zookeeper上对某个节点的值注册个监听器，一旦B系统处理完了就修改zookeeper那个节点的值，A系统立马就可以监听到修改。

### 分布式锁

对某一条数据连续发出两个修改操作，两台机器同时收到了请求，但是只能一台机器先执行完另外一个机器再执行。那么此时就可以使用zookeeper分布式锁，一个机器接收到请求之后先获取zookeeper上的一把分布式锁，就是可以去创建一个znode，接着执行操作；然后另外一个机器也尝试去创建那个znode，结果发现自己创建不了，因为被别人创建了，那就只能等着，等第一个机器执行完了自己再执行。

### 元数据或配置信息管理

zookeeper可以作为很多系统的配置信息管理，比如kafka、storm、dubbo等很多分布式系统都会选择zookeeper来做一些元数据、配置信息的管理。

### HA高可用性

hadoop、hdfs、yarn等很多大数据系统，选择基于zookeeper来开发HA高可用机制，就是一个重要进程一般会做主备两个，主进程挂了立马通过zookeeper感知到，并切换到备用进程。

## zookeeper是如何选举的

选举遵循以下原则:

#### 选举投票必须在同一轮次中进行
如果follower服务选举轮次不同，不会采纳投票。

#### 数据最新的节点优先称为leader
数据的新旧使用事务id判定，事务id越大认为节点数据越接近leader的数据，自然应该称为leader。

#### server.id值越大的优先称为leader
如果每个参与竞选节点事务id一样，再使用server.id做比较。server.id是节点在集群中唯一的id，在myid文件中配置。

## zookeeper分布式锁是如何实现的
重点：zookeeper的分布式锁有两类，一类是保持独占，一类是控制时序。

对于第一类，我们将zookeeper上的一个znode看作是一把锁，通过createznode的方式来实现。所有客户端都去创建/distribute_lock节点，最终成功创建的那个客户端也即拥有了这把锁。用完删除掉自己创建的distribute_lock节点就释放出锁。

对于第二类，/distribute_lock已经预先存在，所有客户端在它下面创建临时顺序编号目录节点，和选master一样，编号最小的获得锁，用完删除。

## 说说分布式一致性算法Paxos
Paxos 分布式一致性算法用来解决一个分布式系统如何就某个值(决议)达成一致的问题，其核心标准就是少数服从多数

## zookeeper集群如果有3台机器，挂掉一台集群还能工作吗？挂掉两台呢？
集群需要一半以上的机器可用，所以，3台挂掉1台还能工作，2台不能。

## zookeeper有哪几种节点类型？
节点类型：持久节点、持久顺序节点、临时节点、临时顺序节点。

